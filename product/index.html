//billing/product/index.html 
<h1 class="page-title">Product Management</h1>
<div id="productList" class="product-grid">
    <!-- Products will be loaded here by JS -->
    <p class="text-center text-light">Loading products...</p>
</div>

<script>
document.addEventListener('DOMContentLoaded', async function fetchProducts() {
    const productListDiv = document.getElementById('productList');
    try {
        const response = await fetch('/billing/server.php?action=getProducts');
        if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
        const products = await response.json();

        if (products && products.length > 0) {
            productListDiv.innerHTML = products.map(product => `
                <div class="product-card card-base">
                    <h3>${product.name}</h3>
                    <p class="card-meta"><strong>Price:</strong> ₹${parseFloat(product.price).toFixed(2)}</p>
                    <p class="card-meta"><strong>Stock:</strong> ${product.stock} units</p>
                </div>
            `).join('');
        } else {
            productListDiv.innerHTML = '<p class="text-center text-light glass p-3">No products found.</p>';
        }
    } catch (error) {
        console.error("Failed to fetch products:", error);
        productListDiv.innerHTML = '<p class="text-center text-light glass p-3">Could not load products. Please try again later.</p>';
        window.popupNotification.error("Failed to load products.", "Data Error");
    }
});
</script>
```

---
**`/billing/staff/billview.html`**
```html
<h1 class="page-title">Bill History</h1>
<section class="content-section glass">
    <h2 class="section-title">Search Bills</h2>
    <input type="text" id="billSearch" class="bill-search-input" placeholder="Search by Product Name or Bill ID...">
    <div id="billList" class="card-list mt-3">
        <!-- Bill cards will be rendered here -->
         <p class="text-center text-light">Loading bill history...</p>
    </div>
</section>

<!-- Bill Details Modal -->
<div id="billModalBackdrop" class="bill-details-modal-backdrop">
    <div id="billModalContent" class="bill-details-modal-content glass">
        <button id="closeBillModalBtn" class="bill-details-modal-close-btn" aria-label="Close modal">&times;</button>
        <div id="modalInnerContent">
            <!-- Modal content will be populated by JS -->
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let allBills = [];
    let allProducts = [];
    const billListDiv = document.getElementById('billList');
    const billSearchInput = document.getElementById('billSearch');
    const billModalBackdrop = document.getElementById('billModalBackdrop');
    const billModalContent = document.getElementById('billModalContent'); // The actual content part
    const modalInnerContentDiv = document.getElementById('modalInnerContent');
    const closeBillModalBtn = document.getElementById('closeBillModalBtn');

    async function initializePageData() {
        try {
            const [productsRes, billsRes] = await Promise.all([
                fetch('/billing/server.php?action=getProducts'),
                fetch('/billing/server.php?action=getBills')
            ]);

            if (!productsRes.ok) throw new Error(`Products fetch failed: ${productsRes.status}`);
            allProducts = await productsRes.json();

            if (!billsRes.ok) throw new Error(`Bills fetch failed: ${billsRes.status}`);
            allBills = await billsRes.json();
            
            renderBills();
        } catch (error) {
            console.error("Error initializing page data:", error);
            billListDiv.innerHTML = '<p class="text-center text-light glass p-3">Could not load bill data. Please try again.</p>';
            window.popupNotification.error("Failed to load bill data.", "Data Error");
        }
    }

    function getProductNameById(productId) {
        const product = allProducts.find(p => (p._id.$oid || p._id) === productId);
        return product ? product.name : 'Unknown Product';
    }

    function renderBills(filter = '') {
        const searchTerm = filter.toLowerCase().trim();
        let filteredBills = allBills;

        if (searchTerm) {
            filteredBills = allBills.filter(bill => {
                const productName = getProductNameById(bill.productId.$oid || bill.productId).toLowerCase();
                const billId = (bill._id.$oid || bill._id).toLowerCase();
                return productName.includes(searchTerm) || billId.includes(searchTerm);
            });
        }

        if (filteredBills.length === 0) {
            billListDiv.innerHTML = `<p class="text-center text-light glass p-3">No bills match your search criteria${searchTerm ? '' : ' yet'}.</p>`;
            return;
        }

        billListDiv.innerHTML = filteredBills.map(bill => {
            const billId = bill._id.$oid || bill._id;
            const productName = getProductNameById(bill.productId.$oid || bill.productId);
            const billDate = bill.date && (bill.date.$date || bill.date) ? new Date(bill.date.$date || bill.date).toLocaleString() : 'N/A';
            const totalAmount = bill.total !== undefined ? parseFloat(bill.total).toFixed(2) : 'N/A';

            return `
            <div class="card-base">
                <h3 class="card-title">${productName}</h3>
                <p class="card-meta">Quantity: ${bill.quantity || 'N/A'}</p>
                <p class="card-meta">Total: ₹${totalAmount}</p>
                <p class="card-meta">Date: ${billDate}</p>
                <p class="card-meta" style="font-size:0.8em; opacity:0.7;">ID: ${billId}</p>
                <div class="card-actions">
                    <button class="btn" onclick="window.expandBillDetails('${billId}')">View Details</button>
                </div>
            </div>`;
        }).join('');
    }

    window.expandBillDetails = function(billId) {
        const bill = allBills.find(b => (b._id.$oid || b._id) === billId);
        if (!bill || !modalInnerContentDiv) return;

        const productName = getProductNameById(bill.productId.$oid || bill.productId);
        const billDate = bill.date && (bill.date.$date || bill.date) ? new Date(bill.date.$date || bill.date).toLocaleString() : 'N/A';
        const totalAmount = bill.total !== undefined ? parseFloat(bill.total).toFixed(2) : 'N/A';

        modalInnerContentDiv.innerHTML = `
            <h2>Bill Details</h2>
            <p><b>Product:</b> ${productName}</p>
            <p><b>Quantity:</b> ${bill.quantity || 'N/A'}</p>
            <p><b>Unit Price:</b> ₹${(totalAmount !== 'N/A' && bill.quantity) ? (parseFloat(totalAmount) / bill.quantity).toFixed(2) : 'N/A'}</p>
            <p><b>Total Amount:</b> ₹${totalAmount}</p>
            <p><b>Date:</b> ${billDate}</p>
            <p><b>Bill ID:</b> ${billId}</p>
        `;
        if (billModalBackdrop) billModalBackdrop.style.display = 'flex';
    };

    function closeModal() {
        if (billModalBackdrop) billModalBackdrop.style.display = 'none';
    }

    if (closeBillModalBtn) closeBillModalBtn.addEventListener('click', closeModal);
    if (billModalBackdrop) { // Close on backdrop click
        billModalBackdrop.addEventListener('click', function(event) {
            if (event.target === billModalBackdrop) {
                closeModal();
            }
        });
    }
     // Close on escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape" && billModalBackdrop && billModalBackdrop.style.display === 'flex') {
            closeModal();
        }
    });


    if (billSearchInput) {
        billSearchInput.addEventListener('input', function() {
            renderBills(this.value);
        });
    }

    initializePageData();
});
</script>