<!DOCTYPE html>
<html lang="en">
<head>
    <title>Staff Bill Management</title>
    <link rel="stylesheet" href="/billing/global.css">
</head>
<body>
    <nav>
        <a href="/billing/">Home</a>
        <a href="/billing/staff/bill">Bill</a>
        <a href="/billing/staff/billview">Bill View</a>
    </nav>
    <h1>Bill Management</h1>

    <!-- Form to bill products -->
    <section>
        <h2>Bill Products</h2>
        <form id="billProductForm">
            <input type="text" name="productId" placeholder="Product ID" required>
            <input type="number" name="quantity" placeholder="Quantity" required>
            <button type="submit">Bill Product</button>
        </form>
    </section>

    <!-- Billing history -->
    <section>
        <h2>Billing History</h2>
        <div id="billList"></div>
    </section>

    <script>
        // Fetch and display billing history
        async function fetchBills() {
            const response = await fetch('/billing/server.php?action=getBills');
            const bills = await response.json();
            const billList = document.getElementById('billList');
            billList.innerHTML = bills.map(bill => `
                <div>
                    <p>Product ID: ${bill.productId}</p>
                    <p>Quantity: ${bill.quantity}</p>
                    <p>Total: ${bill.total}</p>
                    <p>Date: ${new Date(bill.date.$date).toLocaleString()}</p>
                    <a href="/billing/staff/billview?billId=${bill._id}">Expand View</a>
                </div>
            `).join('');
        }

        // Handle billing products
        document.getElementById('billProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            formData.append('action', 'billProduct');
            const response = await fetch('/billing/server.php', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            alert(result.message);
            if (result.status === 'success') {
                fetchBills(); // Refresh billing history
            }
        });

        // Initial fetch of billing history
        fetchBills();
    </script>
</body>
</html>
